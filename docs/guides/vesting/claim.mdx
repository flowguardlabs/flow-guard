---
title: "Claim Vested Tokens"
description: "How a recipient claims their currently vested and unclaimed tokens from a vesting stream."
icon: "hand-holding"
---

The `claim()` function allows a stream recipient to withdraw all currently vested but not-yet-claimed tokens. The covenant enforces the math directly — no trust in the frontend required.

## Claim Formula

**Linear vesting:**
```
elapsed       = tx.locktime - cursor
duration      = endTimestamp - startTimestamp
vestedTotal   = (totalAmount × elapsed) / duration
claimable     = vestedTotal - totalReleased
```

**Step vesting:**
```
completedSteps = elapsed / stepInterval
vestedTotal    = completedSteps × stepAmount
claimable      = vestedTotal - totalReleased
```

Where `cursor` begins at `startTimestamp` and is advanced by the cumulative pause duration each time the stream is resumed.

## Cliff

If `cliffTimestamp > 0`, calling `claim()` before the cliff will fail at the contract level:

```
require(tx.locktime >= cliffTimestamp)
```

After the cliff, all tokens that have vested since `startTimestamp` become claimable at once.

## How to Claim in the App

<Steps>
  <Step title="Open your stream">
    Go to **Streams** and select the stream. The dashboard shows claimable amount, total vested, and time remaining.
  </Step>
  <Step title="Click Claim">
    Click **Claim Vested**. Your wallet will prompt you to sign a transaction.
  </Step>
  <Step title="Confirm">
    The transaction consumes the current stream UTXO and produces:
    - An output to your address with the claimable amount
    - A new stream UTXO with updated `total_released` and optional auto-complete if fully vested
  </Step>
</Steps>

## Auto-Complete

When `newTotalReleased >= totalAmount`, the claim transaction produces no replacement NFT output. The stream is marked `COMPLETED` and disappears from the active streams list.

## API

```bash
POST /api/streams/:id/claim
x-user-address: bchtest:q...
Content-Type: application/json

{
  "recipientAddress": "bchtest:q..."
}

# Response
{
  "success": true,
  "claimableAmount": 1.25,
  "wcTransaction": { "...": "..." }
}

POST /api/streams/:id/confirm-claim
Content-Type: application/json

{
  "claimedAmount": 1.25,
  "txHash": "hex64"
}
```
