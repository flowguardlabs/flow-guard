{
  "contractName": "TallyCommitment_Attested",
  "constructorInputs": [
    {
      "name": "proposalId",
      "type": "bytes32"
    },
    {
      "name": "signer1Hash",
      "type": "bytes20"
    },
    {
      "name": "signer2Hash",
      "type": "bytes20"
    },
    {
      "name": "signer3Hash",
      "type": "bytes20"
    },
    {
      "name": "requiredAttestations",
      "type": "int"
    }
  ],
  "abi": [
    {
      "name": "attestTally",
      "inputs": [
        {
          "name": "sig1",
          "type": "sig"
        },
        {
          "name": "pubkey1",
          "type": "pubkey"
        },
        {
          "name": "sig2",
          "type": "sig"
        },
        {
          "name": "pubkey2",
          "type": "pubkey"
        },
        {
          "name": "tallyCommitment",
          "type": "bytes40"
        }
      ]
    }
  ],
  "bytecode": "OP_6 OP_PICK OP_HASH160 OP_9 OP_PICK OP_HASH160 OP_OVER OP_4 OP_PICK OP_EQUAL OP_2 OP_PICK OP_6 OP_PICK OP_EQUAL OP_BOOLOR OP_2 OP_PICK OP_7 OP_PICK OP_EQUAL OP_BOOLOR OP_VERIFY OP_DUP OP_4 OP_ROLL OP_EQUAL OP_OVER OP_5 OP_ROLL OP_EQUAL OP_BOOLOR OP_OVER OP_5 OP_ROLL OP_EQUAL OP_BOOLOR OP_VERIFY OP_EQUAL OP_NOT OP_VERIFY OP_2SWAP OP_SWAP OP_CHECKSIGVERIFY OP_2SWAP OP_SWAP OP_CHECKSIGVERIFY OP_2 OP_PICK OP_2 OP_SPLIT OP_NIP OP_4 OP_SPLIT OP_DROP OP_SWAP OP_4 OP_SPLIT OP_DROP OP_EQUALVERIFY OP_OVER OP_1 OP_SPLIT OP_NIP OP_1 OP_SPLIT OP_DROP OP_BIN2NUM OP_1 OP_NUMEQUALVERIFY OP_0 OP_OUTPUTTOKENCOMMITMENT OP_ROT OP_EQUALVERIFY OP_0 OP_OUTPUTBYTECODE OP_0 OP_UTXOBYTECODE OP_EQUALVERIFY OP_2 OP_NUMEQUAL",
  "source": "/**\n * TallyCommitment_Attested — M-of-N attested tally fallback\n *\n * ENFORCEABILITY: [HYBRID]\n *\n * PURPOSE: For proposals with > 3 voters (pre-Layla limit).\n * Off-chain tally computation + on-chain 2-of-3 attestation.\n * Independent validators verify tally independently.\n *\n * NFT COMMITMENT (40 bytes — within CashTokens 40-byte limit):\n *   Same layout as TallyCommitment_FixedMax.\n *\n * POST-LAYLA: Loops CHIP enables fully trustless arbitrary tally.\n */\n\npragma cashscript ^0.13.0;\n\ncontract TallyCommitment_Attested(\n    bytes32 proposalId,\n    bytes20 signer1Hash,\n    bytes20 signer2Hash,\n    bytes20 signer3Hash,\n    int requiredAttestations\n) {\n    /**\n     * attestTally() — 2-of-3 signers attest to off-chain computed tally\n     *\n     * Signers verify the tally off-chain and co-sign the commitment.\n     * On-chain: validates 2 distinct registered signers, correct proposal ref.\n     */\n    function attestTally(\n        sig sig1, pubkey pubkey1,\n        sig sig2, pubkey pubkey2,\n        bytes40 tallyCommitment\n    ) {\n        bytes20 pk1Hash = hash160(pubkey1);\n        bytes20 pk2Hash = hash160(pubkey2);\n\n        require(\n            pk1Hash == signer1Hash ||\n            pk1Hash == signer2Hash ||\n            pk1Hash == signer3Hash\n        );\n        require(\n            pk2Hash == signer1Hash ||\n            pk2Hash == signer2Hash ||\n            pk2Hash == signer3Hash\n        );\n        require(pk1Hash != pk2Hash);\n\n        require(checkSig(sig1, pubkey1));\n        require(checkSig(sig2, pubkey2));\n\n        // Tally commitment must reference this proposal (bytes [2:6])\n        require(tallyCommitment.split(2)[1].split(4)[0] == proposalId.split(4)[0]);\n\n        // Status byte at offset 1 must be FINALIZED (1)\n        require(int(tallyCommitment.split(1)[1].split(1)[0]) == 1);\n\n        require(tx.outputs[0].nftCommitment == tallyCommitment);\n        require(tx.outputs[0].lockingBytecode == tx.inputs[0].lockingBytecode);\n        require(requiredAttestations == 2);\n    }\n}\n",
  "debug": {
    "bytecode": "5679a95979a97854798752795679879b52795779879b6976547a8778557a879b78557a879b69879169727cad727cad5279527f77547f757c547f758878517f77517f7581519d00d27b8800cd00c788529c",
    "sourceMap": "36:34:36:41;;:26::42:1;37:34:37:41:0;;:26::42:1;40:12:40:19:0;:23::34;;:12:::1;41::41:19:0;;:23::34;;:12:::1;40;42::42:19:0;;:23::34;;:12:::1;40;39:8:43:10;45:12:45:19:0;:23::34;;:12:::1;46::46:19:0;:23::34;;:12:::1;45;47::47:19:0;:23::34;;:12:::1;45;44:8:48:10;49:16:49:34;;:8::36;51:25:51:38:0;;:8::41:1;52:25:52:38:0;;:8::41:1;55:16:55:31:0;;:38::39;:16::40:1;:::43;:50::51:0;:16::52:1;:::55;:59::69:0;:76::77;:59::78:1;:::81;:8::83;58:20:58:35:0;:42::43;:20::44:1;:::47;:54::55:0;:20::56:1;:::59;:16::60;:64::65:0;:8::67:1;60:27:60:28:0;:16::43:1;:47::62:0;:8::64:1;61:27:61:28:0;:16::45:1;:59::60:0;:49::77:1;:8::79;62:40:62:41:0;:8::43:1",
    "logs": [],
    "requires": [
      {
        "ip": 27,
        "line": 39
      },
      {
        "ip": 42,
        "line": 44
      },
      {
        "ip": 45,
        "line": 49
      },
      {
        "ip": 48,
        "line": 51
      },
      {
        "ip": 51,
        "line": 52
      },
      {
        "ip": 64,
        "line": 55
      },
      {
        "ip": 74,
        "line": 58
      },
      {
        "ip": 78,
        "line": 60
      },
      {
        "ip": 83,
        "line": 61
      },
      {
        "ip": 86,
        "line": 62
      }
    ]
  },
  "compiler": {
    "name": "cashc",
    "version": "0.13.0-next.3"
  },
  "updatedAt": "2026-02-26T11:11:00.831Z"
}